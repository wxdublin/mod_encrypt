CROSS_COMPILE?=

CC = gcc
CPP = g++
LD = g++

INCDIR = -I../aes/ -I../aes_ni/ -I../chacha/
LIBDIR = -L/usr/local/lib
SRCDIR = ../aes/ ../aes_ni/ ../chacha/

VPATH = .. $(SRCDIR)

CFLAGS = -Wall -O2 $(INCDIR) -DLINUX
LDFLAGS = $(LIBDIR) -lpthread -lssl -lcrypto

TARGET = benchmark

SRCS = $(foreach dir, .. $(SRCDIR), $(wildcard $(dir)/*.c))
SRCS := $(notdir $(SRCS))

SRCSCPP = $(foreach dir, .. $(SRCDIR), $(wildcard $(dir)/*.cpp))
SRCSCPP := $(notdir $(SRCSCPP))

OBJS = $(SRCS:.c=.o)

OBJSCPP = $(SRCSCPP:.cpp=.o)

all: $(TARGET)

$(TARGET) : $(OBJS) $(OBJSCPP)
	$(CROSS_COMPILE)$(LD) $^ -o $(TARGET) $(LIBS) $(LDFLAGS)
	mv $(TARGET) ../

%o:%c
	$(CROSS_COMPILE)$(CC) $(CFLAGS) -c $< -o $@

%o:%cpp
	$(CROSS_COMPILE)$(CPP) $(CFLAGS) -c $< -o $@

clean:
	-rm -rf $(OBJS)
	-rm -rf $(OBJSCPP)
	-rm -f ../$(TARGET)
	-rm -f depend
	-rm -f ../*.*~
	-rm -f ./../src/*.*~

depend: $(SRCS)
	$(CROSS_COMPILE)$(CC) -M $(CFLAGS) $^ > $@

-include depend
